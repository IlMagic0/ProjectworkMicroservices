<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Processing Client</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .preview, .result { margin-top: 20px; }
    img { max-width: 300px; display: block; margin-top: 10px; }
    button { margin-top: 10px; padding: 10px 20px; cursor: pointer; }
    input[type="file"] { margin-top: 10px; }
  </style>
</head>
<body>
<h1>Image Processing Client</h1>

<label>Select an image to process:</label>
<input type="file" id="fileInput" accept="image/*">

<div class="preview">
  <h3>Original Image:</h3>
  <img id="originalImage" src="#" alt="Original Preview" style="display:none;">
</div>

<button id="processBtn">Process Image</button>

<div class="result">
  <h3>Processed Image:</h3>
  <img id="processedImage" src="#" alt="Processed Preview" style="display:none;">
  <a id="downloadLink" href="#" download="rendered_image.png" style="display:none;">Download Rendered Image</a>
</div>

<script>
  const fileInput = document.getElementById('fileInput');
  const originalImage = document.getElementById('originalImage');
  const processedImage = document.getElementById('processedImage');
  const downloadLink = document.getElementById('downloadLink');
  const processBtn = document.getElementById('processBtn');

  let selectedFile;

  fileInput.addEventListener('change', (event) => {
    selectedFile = event.target.files[0];
    if (selectedFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        originalImage.src = e.target.result;
        originalImage.style.display = 'block';
      };
      reader.readAsDataURL(selectedFile);
    }
  });

  processBtn.addEventListener('click', () => {
    if (!selectedFile) {
      alert('Please select an image first.');
      return;
    }

    const formData = new FormData();
    formData.append('file', selectedFile);

    fetch('http://localhost:8080/process-image', {  // Adjust to your Spring Boot endpoint
      method: 'POST',
      body: formData
    })
            .then(response => {
              if (!response.ok) throw new Error('Failed to process image');
              return response.blob();
            })
            .then(blob => {
              const url = URL.createObjectURL(blob);
              processedImage.src = url;
              processedImage.style.display = 'block';

              downloadLink.href = url;
              downloadLink.style.display = 'inline-block';
            })
            .catch(error => {
              console.error(error);
              alert('Error processing image');
            });
  });
</script>
</body>
</html>
